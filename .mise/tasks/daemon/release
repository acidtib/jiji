#!/usr/bin/env bash
#MISE description="Cross-compile daemon for Linux"
set -e

COMPILE_FLAGS="--allow-net --allow-read --allow-env --allow-run"

targets=(
  "x86_64-unknown-linux-gnu:jiji-daemon-linux-x64"
  "aarch64-unknown-linux-gnu:jiji-daemon-linux-arm64"
)

for entry in "${targets[@]}"; do
  target="${entry%%:*}"
  output="${entry##*:}"
  echo "Compiling daemon â†’ target/${output} (${target})"
  deno compile $COMPILE_FLAGS --target "$target" --output "target/${output}" packages/daemon/src/main.ts
done
